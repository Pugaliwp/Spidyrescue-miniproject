<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Spidy Rescue: Chaos City</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <div id="game-container">
    <!-- HUD -->
    <div id="hud">
      <div class="hud-group">
        <div class="hud-item" style="color: #ff6b6b;">
          <span>Lives:</span> <span id="hud-lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
        </div>
        <div class="hud-item" style="color: #4ecdc4;">
          <span>Target:</span> <span id="hud-sub-text" class="hud-sub-text">Save</span> <span
            id="hud-next">Everyone</span>
        </div>
      </div>

      <div class="hud-group">
        <div class="hud-item">
          <span id="level-title">Level 1</span>
        </div>
      </div>

      <!-- Score and Time removed from HUD as per request -->
    </div>

    <!-- Canvas -->
    <canvas id="gameCanvas"></canvas>

    <!-- UI Screens -->

    <!-- Start Screen -->
    <div id="start-screen" class="screen hidden">
      <div class="modal">
        <div class="modal-content">
          <div class="logo-container">
            <h1 class="title-spidy">SPIDY</h1>
            <h1 class="title-rescue">RESCUE</h1>
          </div>
          <h2 class="subtitle-city">CHAOS CITY</h2>
          <p class="description-text">The city is in danger! Rescue citizens from the precarious platforms before time
            runs out. Avoid the hazards!</p>

          <div class="controls-box">
            <p class="controls-header">üéÆ Controls:</p>
            <div class="controls-row"><span class="key">‚Üê</span> <span class="key">‚Üí</span> <span
                class="label">Move</span></div>
            <div class="controls-row"><span class="key">Space</span> <span class="or">or</span> <span
                class="key">‚Üë</span> <span class="label">Jump</span></div>
          </div>

          <button id="continue-btn" class="btn play-btn"
            style="display: none; background: #6b46c1; margin-bottom: 10px;">CONTINUE</button>
          <button id="start-btn" class="btn play-btn">NEW GAME</button>

          <div class="credits-box">
            <p class="credits-title">CREATED BY</p>
            <p class="credit-name">PRAJUKTA DAS</p>
            <p class="credit-name">SATHWIK</p>
            <p class="credit-name">PUGALMANI</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Level Selection Screen -->
    <div id="level-select-screen" class="screen hidden">
      <div class="modal">
        <div class="modal-content level-select-content">
          <h2 class="level-title">SELECT LEVEL</h2>
          <div id="level-grid" class="level-grid">
            <!-- Buttons generated by JS -->
          </div>
          <div class="menu-buttons">
            <button id="back-to-menu-btn" class="btn btn-secondary">Back</button>
            <button id="open-leaderboard-btn" class="btn">Leaderboard</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Leaderboard Screen -->
    <div id="leaderboard-screen" class="screen hidden">
      <div class="leaderboard-panel">
        <button id="close-leaderboard-btn" class="close-btn">√ó</button>
        <h3>GLOBAL RANKING</h3>
        <div class="leaderboard-header">
          <span>RK</span>
          <span>PLAYER</span>
          <span>SCORE</span>
        </div>
        <div id="leaderboard-list" class="leaderboard-list">
          <!-- Filled by JS -->
        </div>
      </div>
    </div>

    <!-- Pause Menu -->
    <div id="pause-screen" class="screen hidden">
      <div class="modal">
        <div class="modal-content">
          <h2>PAUSED</h2>
          <button id="resume-btn" class="btn">Resume</button>
          <button id="pause-restart-btn" class="btn btn-secondary">Restart Level</button>
          <button id="main-menu-btn" class="btn btn-secondary">Main Menu</button>
          <button id="settings-btn" class="btn btn-secondary">Settings</button>
        </div>
      </div>
    </div>

    <!-- Settings Menu -->
    <div id="settings-screen" class="screen hidden">
      <div class="modal">
        <div class="modal-content">
          <h2>Settings</h2>

          <div class="setting-item">
            <label for="speed-slider">Move Sensitivity (Speed)</label>
            <input type="range" id="speed-slider" min="5" max="15" step="1" value="8">
            <span id="speed-val">8</span>
          </div>

          <div class="setting-item">
            <label for="jump-slider">Jump Sensitivity (Force)</label>
            <input type="range" id="jump-slider" min="15" max="30" step="1" value="22">
            <span id="jump-val">22</span>
          </div>

          <div class="setting-item audio-toggle-group"
            style="margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px;">
            <div class="audio-toggle">
              <label for="bg-music-toggle">Background Music</label>
              <input type="checkbox" id="bg-music-toggle" checked>
            </div>
            <div class="audio-toggle" style="margin-top: 15px;">
              <label for="sfx-toggle">Game Sounds (SFX)</label>
              <input type="checkbox" id="sfx-toggle" checked>
            </div>
          </div>

          <div class="setting-item" style="margin-top: 20px;">
            <button id="reset-settings-btn" class="btn btn-secondary">Reset Defaults</button>
            <button id="close-settings-btn" class="btn">Back</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Mobile Controls -->
    <div id="mobile-controls" class="hidden">
      <div class="d-pad">
        <button id="btn-left" class="touch-btn">‚Üê</button>
        <button id="btn-right" class="touch-btn">‚Üí</button>
      </div>
      <button id="btn-jump" class="touch-btn">JUMP</button>
    </div>

    <!-- In-Game Home Button -->
    <button id="home-btn" class="hidden">üè†</button>

    <!-- Level Complete -->
    <div id="level-screen" class="screen hidden">
      <div class="modal">
        <div class="modal-content">
          <h2>Mission Completed!</h2>
          <div id="level-score-disp" class="score-display">Score: 1000</div>

          <table class="stats-table">
            <thead>
              <tr>
                <th>Citizen</th>
                <th>Priority</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="summary-table-body">
              <!-- Filled by JS -->
            </tbody>
          </table>
          <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px;">
            <button id="restart-level-btn" class="btn" style="background: #e53e3e;">Restart</button>
            <button id="next-level-btn" class="btn">Next Level</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading Screen -->
    <div id="loading-screen" class="screen active">
      <h1>Welcome to Spidy Rescue</h1>
      <div class="loading-container">
        <div class="loading-bar-border">
          <div class="loading-bar-fill" id="loading-bar-fill"></div>
        </div>
        <div class="loading-text">LOADING...</div>
      </div>
    </div>

    <!-- User Info Screen -->
    <div id="user-info-screen" class="screen hidden">
      <div class="modal">
        <div class="modal-content">
          <h2>WELCOME</h2>

          <div class="user-type-toggle" style="display: flex; justify-content: center; gap: 10px; margin-bottom: 20px;">
            <button id="btn-new-user" class="btn active-type"
              style="font-size: 0.8rem; padding: 5px 15px; background: #4ecdc4;">New User</button>
            <button id="btn-existing-user" class="btn"
              style="font-size: 0.8rem; padding: 5px 15px; background: #555;">Existing User</button>
          </div>

          <p id="info-text">Create a unique identity to start.</p>

          <div class="form-group">
            <input type="text" id="user-name" placeholder="Enter Unique Username" autocomplete="off">
            <div id="name-error" style="color: #ff6b6b; font-size: 0.8rem; display: none; margin-top: 5px;"></div>
          </div>

          <div class="form-group" id="age-group">
            <input type="number" id="user-age" placeholder="Enter Your Age" autocomplete="off" min="1" max="120">
          </div>

          <button id="submit-user-btn" class="btn">START GAME</button>
        </div>
      </div>
    </div>

    <!-- Wasted Overlay -->
    <div id="wasted-overlay" class="screen hidden" style="background: transparent; pointer-events: none; z-index: 250;">
      <h1 class="wasted-text">WASTED</h1>
    </div>

    <!-- Game Over -->
    <div id="game-over-screen" class="screen hidden">
      <div class="modal">
        <div class="modal-content">
          <h2 style="color: #ff6b6b;">Mission Failed</h2>
          <p>Spidy has fallen.</p>
          <div style="display: flex; gap: 15px; margin-top: 20px;">
            <button id="retry-btn" class="btn">Try Again</button>
            <button id="game-over-menu-btn" class="btn" style="background: #4a5568;">Main Menu</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Victory -->
    <div id="victory-screen" class="screen hidden">
      <div class="modal">
        <div class="modal-content">
          <h1 class="title">CITY SAVED!</h1>
          <p>You have beaten all available levels!</p>
          <div style="color: #ffd700; font-weight: bold; margin: 10px 0;">Levels 11-100 Coming Soon!</div>
          <p style="font-size: 0.9em; opacity: 0.8;">You have restored peace to the city.</p>
          <div class="score-display">Final Score: <span id="final-score-win">0</span></div>
          <button id="restart-btn" class="btn">Play Again</button>
        </div>
      </div>
    </div>

  </div>

  <script>
    window.onerror = function (msg, url, lineNo, columnNo, error) {
      alert("Game Error: " + msg + "\nLine: " + lineNo);
      return false;
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabase_client.js"></script>
  <script src="leaderboard_manager.js"></script>
  <script src="game.js"></script>
</body>

</html>